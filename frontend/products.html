<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Data Produk - J Store</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light p-4">
    <div class="container">
      <!-- Tombol Kembali ke Dashboard -->
      <a href="index.html" class="btn btn-secondary mb-3"
        >‚Üê Kembali ke Dashboard</a
      >

      <h2 class="mb-4">Manajemen Produk</h2>

      <form id="addProductForm" class="mb-4">
        <div class="row g-2">
          <div class="col">
            <input
              type="text"
              id="pname"
              class="form-control"
              placeholder="Nama Produk"
              required
            />
          </div>
          <div class="col">
            <input
              type="number"
              id="pprice"
              class="form-control"
              placeholder="Harga"
              required
            />
          </div>
          <div class="col">
            <input
              type="number"
              id="pstock"
              class="form-control"
              placeholder="Stok"
              required
            />
          </div>
          <div class="col">
            <button class="btn btn-primary w-100">Tambah</button>
          </div>
        </div>
      </form>

      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nama</th>
            <th>Harga</th>
            <th>Stok</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="productTable"></tbody>
      </table>
    </div>

    <script>
      const apiP = "http://localhost:3000/products";

      function loadProducts() {
        fetch(apiP)
          .then((res) => res.json())
          .then((data) => {
            const tbody = document.getElementById("productTable");
            tbody.innerHTML = "";

            data.forEach((p) => {
              tbody.innerHTML += `
          <tr>
            <td>${p.id}</td>
            <td><input class='form-control' id='pname_${p.id}' value='${p.name}'></td>
            <td><input class='form-control' id='pprice_${p.id}' value='${p.price}'></td>
            <td><input class='form-control' id='pstock_${p.id}' value='${p.stock}'></td>
            <td>
              <button class='btn btn-warning btn-sm' onclick='updateP(${p.id})'>Update</button>
              <button class='btn btn-danger btn-sm' onclick='deleteP(${p.id})'>Hapus</button>
            </td>
          </tr>
        `;
            });
          });
      }

      function updateP(id) {
        const data = {
          name: document.getElementById(`pname_${id}`).value,
          price: document.getElementById(`pprice_${id}`).value,
          stock: document.getElementById(`pstock_${id}`).value,
        };

        fetch(`${apiP}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        }).then(loadProducts);
      }

      function deleteP(id) {
        fetch(`${apiP}/${id}`, { method: "DELETE" }).then(loadProducts);
      }

      document
        .getElementById("addProductForm")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const data = {
            name: pname.value,
            price: pprice.value,
            stock: pstock.value,
          };
          fetch(apiP, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          }).then(() => {
            e.target.reset();
            loadProducts();
          });
        });

      loadProducts();
    </script>
  </body>
</html>
